---
meta:
  title: Migrating from another managed Kubernetes service to Scaleway Kapsule
  description: Step-by-step guide to migrate your Kubernetes clusters from services like GKE, EKS, or AKS to Scaleway Kapsule with minimal downtime.
content:
  h1: Migrating from another managed Kubernetes service to Scaleway Kapsule
  paragraph: Step-by-step guide to migrate your Kubernetes clusters from services like GKE, EKS, or AKS to Scaleway Kapsule with minimal downtime.
tags: pgloader postgresql mysql migration
categories:
  - kubernetes
dates:
  validation: 2024-11-13
  posted: 2024-11-13
---

This guide provides a step-by-step process to help you migrate your existing Kubernetes clusters from other managed services like GKE (Google Kubernetes Engine), EKS (Amazon Elastic Kubernetes Service), or AKS (Azure Kubernetes Service) to **Scaleway Kapsule**. The migration aims to minimize downtime and ensure a smooth transition of your workloads.


<Macro id="requirements" />

- A Scaleway account logged into the [console](https://console.scaleway.com)
- [Owner](/identity-and-access-management/iam/concepts/#owner) status or [IAM permissions](/identity-and-access-management/iam/concepts/#permission) allowing you to perform actions in the intended Organization
- Access to an existing Kubernetes cluster
- Basic knowledge and familiarity with Kubernetes concepts and tools.
- Installed the following tools: `kubectl`, `helm` (if used), and `scaleway CLI` (optional but recommended).
-Access to your container images stored in a registry (Scaleway Container Registry, Docker Hub, ECR, GCR, etc.).

## Overview of migration steps

1. **Assess and Document Current Cluster Resources**
2. **Set Up Scaleway Environment**
3. **Migrate Container Images to Scaleway Container Registry**
4. **Create a Kapsule Kubernetes Cluster**
5. **Configure kubectl for Kapsule**
6. **Adapt Kubernetes Manifests and Configurations**
7. **Migrate Persistent Data and Storage**
8. **Deploy Applications to Kapsule**
9. **Update Networking and DNS Configurations**
10. **Test and Validate Deployments**
11. **Switch Over Production Traffic**
12. **Monitor and Optimize the New Cluster**
13. **Decommission the Old Cluster**

## Step 1: Assess and document current cluster resources

Before starting the migration, thoroughly document your existing cluster's configuration.

### 1.1 Inventory of resources

- **Namespaces**: List all namespaces in use.
- **Deployments and StatefulSets**: Identify all applications running.
- **Services**: Document LoadBalancers, NodePorts, ClusterIPs.
- **ConfigMaps and Secrets**: Export configurations and sensitive data.
- **Ingress Controllers**: Note any Ingress resources and controllers used.
- **Persistent Volumes and Claims**: List all storage resources.
- **Custom Resource Definitions (CRDs)**: Document any CRDs and associated operators.
- **Network Policies**: Record any network policies in place.

### 1.2 Export ùanifests

Use kubectl to export the manifests of your resources:

```
kubectl get all --all-namespaces -o yaml > cluster-resources.yaml

kubectl get pvc --all-namespaces -o yaml > pvcs.yaml

kubectl get configmaps --all-namespaces -o yaml > configmaps.yaml

kubectl get secrets --all-namespaces -o yaml > secrets.yaml

kubectl get ingress --all-namespaces -o yaml > ingress.yaml

kubectl get crd --all-namespaces -o yaml > crds.yaml
```

<Message type="note">
  Be cautious with secrets; ensure they are handled securely.
</Message>

## Step 2: Set Up Scaleway environment

### 2.1 Create a Scaleway account

If you do not already have one, [sign up for a Scaleway account](https://console.scaleway.com/register/).

### 2.2 Install Scaleway CLI (Optional)

[Installing the Scaleway CLI](https://github.com/scaleway/scaleway-cli) can simplify some tasks.

```sh
curl -s <https://raw.githubusercontent.com/scaleway/scaleway-cli/master/scripts/get.sh> | sh
scw init
```

Follow the prompts to configure your access keys.

## Step 3: Migrate container images to Scaleway Container Registry

Your new cluster will need access to your container images.

### 3.1 Set Up Scaleway Container Registry

#### Create a namespace

1. Log in to the [Scaleway Console](https://console.scaleway.com/).
2. Navigate to **Container Registry**.
3. Click **Create a Namespace**.
4. Provide a **Name** (e.g., `my-apps`) and select a **Region**.
5. Click **Create a Namespace**.

### 3.2 Authenticate Docker with Scaleway Registry

```sh
docker login rg.<region>.scw.cloud
```

<Message type="tip">
  Use your **Scaleway credentials** or generate a dedicated token.
</Message>

### 3.3 Pull Images from existing registry and push to Scaleway

For each image, you need to migrate:

```sh
# Pull the image from your existing registry

docker pull <original-registry>/<image-name>:<tag>

# Tag the image for Scaleway Registry

docker tag <original-registry>/<image-name>:<tag> rg.<region>.scw.cloud/<namespace>/<image-name>:<tag>

# Push the image to Scaleway Registry

docker push rg.<region>.scw.cloud/<namespace>/<image-name>:<tag>
```

<Message type="tip">
  **Automate the Process**: Consider scripting this process if you have many images.
</Message>

## Step 4: Create a Kapsule Kubernetes cluster

### 4.1 Using the Scaleway console

1. Navigate to **[Kubernetes](https://console.scaleway.com/kubernetes/clusters)** in the Scaleway console.
2. Click **Create a cluster**.
3. Configure your cluster:

    - **Name**: e.g., `production-cluster`.
    - **Region**: Choose the same region as your container registry if possible.
    - **Version**: Select the latest stable Kubernetes version.
    - **Node Pools**:
        - Add node pools matching your workload requirements.
        - Select appropriate **Instance Types** based on CPU, memory, and storage needs.
        - **Autoscaling**: Enable if required.
    - **Networking**:
        - **VPC**: Enable VPC for private networking.
        - **CNI Plugin**: Use the default unless you have specific needs.
4. **Advanced Options**:
    - **API Server Endpoint Access**: Configure public/private access as needed.
    - **Tags and Labels**: Add any metadata for organization.
5. Click **Create Cluster**.

### 4.2 Wait for cluster provisioning

- The process may take several minutes.
- Once ready, the cluster status will be **Ready**.

## Step 5: Configure kubectl for Kapsule

### 5.1 Download kubeconfig

1. In the Scaleway console, go to your cluster's **Overview** page.
2. Click **Download kubeconfig**.
3. Save the file to ~/.kube/kapsule-config.

### 5.2 Update kubeconfig

```sh
export KUBECONFIG=~/.kube/kapsule-config:~/.kube/config

kubectl config view --flatten > ~/.kube/config_combined

mv ~/.kube/config_combined ~/.kube/config

unset KUBECONFIG

```
This merges the Kapsule kubeconfig with your existing config.

### 5.3 Set the current context

- List Available Contexts to identify the name of the context for your Kapsule cluster

```
kubectl config get-contexts
```

- Set the Kapsule Cluster as the Current Context by replacing <kapsule-context-name> with the context name for your Kapsule cluster.

```
kubectl config use-context <kapsule-context-name>
```

- Confirm that your context has been updated

```
kubectl config current-context
```

### 5.4 Verify connection

```
kubectl get nodes
```

## Step 6: Adapt Kubernetes manifests and configurations

Your existing manifests may contain cloud-provider-specific settings that need adjustment.

### 6.1 Review and modify manifests

#### Storage classes

- Update storage classes to match Scaleway's offerings.
- List available storage classes:

```sh
kubectl get storageclass
```

- Common storage classes in Scaleway:
  - `scw-bssd` (Block Storage)
  - `scw-sbs` (Faster Block Storage)

#### Load Balancers

- Modify Service definitions of type LoadBalancer to use Scaleway's load balancers.
- Ensure annotations specific to other cloud providers are removed or replaced.

#### Ingress controllers

- Deploy an Ingress controller compatible with Kapsule (e.g., NGINX Ingress Controller).

#### Networking policies

- Review and adjust network policies as needed.
- Ensure they align with Scaleway's network architecture.

#### ConfigMaps and secrets

- Ensure sensitive data is securely managed.
- Recreate Secrets in the new cluster.

#### Persistent Volume Claims (PVCs)

- Update PVC definitions to use appropriate storage classes.

### 6.2 Remove unsupported resources

- Remove any resources or configurations that are not supported in Kapsule.
- For example, certain annotations or cloud-specific resource definitions.

## Step 7: Migrate persistent Data and storage

### 7.1 Backup data from existing cluster

- Use appropriate tools to back up data from Persistent Volumes.
- Methods include:
  - **Database dumps**: For databases, perform data exports.
  - **File system copy**: For file storage, copy data to a temporary location.

### 7.2 Restore data to Kapsule cluster

- Create PersistentVolumeClaims in Kapsule.
- Restore data into the new volumes:
  - **Init containers**: Use init containers to populate data.
  - **Data import jobs**: Run Kubernetes jobs to import data.

## Step 8: Deploy applications to Kapsule

### 8.1 Apply manifests to the new cluster

```
kubectl apply -f adjusted-manifests
```

- Ensure you are using the correct context for Kapsule.

### 8.2 Deploy Ingress Controller

- Deploy NGINX Ingress Controller:

```
kubectl apply -f <https://raw.githubusercontent.com/kubernetes/ingress-nginx/controller-v1.2.1/deploy/static/provider/cloud/deploy.yaml>
```

### 8.3 Verify Deployments

```
kubectl get pods --all-namespaces

kubectl get services --all-namespaces

kubectl get ingress --all-namespaces
```

- Ensure all pods are running and services are correctly configured.

## Step 9: Update networking and DNS configurations

### 9.1 External DNS (if used)

- If you use external DNS, configure it to work with Scaleway's DNS or your DNS provider.

### 9.2 Update DNS records

- Point your domain names to the new load balancer IPs or addresses.
- Update A records, CNAMEs, or configure your CDN as necessary.

### 9.3 Configure SSL/TLS certificates

- Use Cert-Manager to manage SSL certificates in Kapsule.
- Install Cert-Manager:

```
kubectl apply -f <https://github.com/jetstack/cert-manager/releases/download/v1.8.0/cert-manager.yaml>
```

Configure issuers and certificates as per your requirements.

## Step 10: Test and validate deployments

### 10.1 Functional testing

- Access your applications via their URLs.
- Perform end-to-end testing to ensure functionality.

### 10.2 Performance testing

- Conduct load testing to verify performance under expected loads.

### 10.3 Monitoring and logging

- Set up monitoring tools (e.g., Prometheus, Grafana) to observe cluster health.
- Configure logging solutions to collect and analyze logs.

## Step 11: Switch over production traffic

### 11.1 Plan for cutover

- Choose a low-traffic period if possible.
- Notify stakeholders of potential downtime or changes.

### 11.2 Final synchronization

- Sync any data changes that occurred during testing.

### 11.3 Update DNS TTL

- Reduce DNS Time-to-Live (TTL) to allow for quicker propagation.

### 11.4 Update DNS to point to Kapsule

- Change DNS records to point to the new cluster's ingress endpoints.

### 11.5 Monitor traffic

- Ensure that traffic is flowing to the new cluster.
- Monitor for any errors or issues.

## Step 12: Monitor and optimize the new cluster

### 12.1 Resource usage

- Monitor CPU, memory, and storage usage in [Scaleway Cockpit](add link).
- Adjust node pool sizes or autoscaling settings as needed.

### 12.2 Security

- Review security configurations.
- Ensure network policies and IAM roles are properly set.

### 12.3 Cost monitoring

- Keep an eye on the cluster's costs.
- Optimize resource allocation to balance performance and expenses.

## Step 13: Decommission the old cluster

### 13.1 Ensure stability

- Allow the new cluster to run in production for a sufficient period.
- Confirm that there are no outstanding issues.

### 13.2 Backup data

- Take final backups from the old cluster if needed.

### 13.3 Delete resources

- Carefully delete resources in the old cluster to avoid incurring costs.
- Delete the cluster following your provider's procedures.

### 13.4 Update documentation

- Document the new cluster setup.
- Update any operational runbooks or procedures.

## Troubleshooting tips

- **Authentication Issues**: Verify kubeconfig contexts and credentials.
- **Resource Quotas**: Check for any limitations in Scaleway that may affect deployments.
- **Persistent Volume Issues**: Ensure storage classes and PVCs are correctly configured.
- **Networking Problems**: Verify VPC configurations, network policies, and firewall rules.
- **Image Pull Errors**: Confirm that images are correctly tagged and accessible in Scaleway Container Registry.

## Additional considerations

### Leveraging Scaleway features

- **Elastic Metal nodes**: For workloads requiring dedicated resources, consider adding Elastic Metal nodes to your cluster.
- **Autoscaling**: Use cluster and pod autoscaling to handle variable workloads efficiently.
- **Private Networking**: Use VPC and private networks for enhanced security.

### Cost management

- **Transparent pricing**: Familiarize yourself with Scaleway's pricing models.
- **Cost estimation tools**: Use Scaleway's tools or third-party services to estimate and monitor costs.

### Security best practices

- **IAM policies**: Set up proper access controls.
- **Regular updates**: Keep Kubernetes and applications up to date with security patches.
- **Secrets management**: Use Kubernetes Secrets securely, and consider external secret management solutions if necessary.

## Additional resources

- **Scaleway Documentation**:
  - [Kubernetes Kapsule](https://www.scaleway.com/en/docs/compute/kubernetes/)
  - [Scaleway Container Registry](https://www.scaleway.com/en/docs/containers/container-registry/)
  - [Block Storage](https://www.scaleway.com/en/docs/compute/block-storage/)
- **Kubernetes Documentation**:
  - [Kubernetes Official Documentation](https://kubernetes.io/docs/home/)
  - [Storage Classes](https://kubernetes.io/docs/concepts/storage/storage-classes/)
  - [Ingress Controllers](https://kubernetes.io/docs/concepts/services-networking/ingress-controllers/)
- **Community and Support**:
  - [Scaleway Support](https://console.scaleway.com/support/tickets)
  - [Scaleway Community](https://community.scaleway.com/)
  - [Kubernetes Slack](https://slack.k8s.io/)

## Feedback and assistance

If you encounter issues or have questions during your migration:

- **Contact support**: Use the Scaleway support portal for technical assistance.
- **Community forums**: Engage with other users and experts in the Scaleway Community.
- **Provide feedback**: Your input helps improve services and documentation.