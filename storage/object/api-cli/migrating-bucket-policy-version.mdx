---
meta:
  title: Migrating from a bucket policy version to another
  description: This page shows how to migrate from a bucket policy version to a more recent one.
content:
  h1: Migrating from a bucket policy version to another
  paragraph: This page shows how to migrate from a bucket policy version to a more recent one.
tags: object storage object-storage bucket-policy version migrate upgrade
dates:
  validation: 2023-10-02
  posted: 2023-10-02
categories:
  - storage
  - object-storage
---

Several bucket policy versions coexist in the context of Scaleway Object storage, and each version has its own mode of operation. A more recent version can help managing the access rights to an existing bucket.

Refer to the [bucket policy versions](/storage/object/api-cli/bucket-policy/#bucket-policy-versions) documentation for more information.

## Migrating from V2 to V3

1. Remove any `Deny` statements from your V2 bucket policy as they do not have any effects.

2. Replace `Allow` statements by `Deny` statements.

3. Replace the `Principal` element by `NotPrincipal` and keep the users and applications concerned.
    <Message type="note">
    Instead of allowing a user or application to perform actions, the bucket policy denies everyone **EXCEPT** the users and applications specified.
    </Message>
4. Replace any `Condition` element by its opposite:

- `IpAddress` \<-> `NotIpAddress`
- `StringEquals` \<-> `StringNotEquals`
- `StringEqualsIgnoreCase` \<-> `StringNotEqualsIgnoreCase`
- `StringLike` \<-> `StringNotLike`
- `DateGreaterThan` \<-> `DateLessThanEquals`
- `DateGreaterThanEquals` \<-> `DateLessThan`

## Bucket policy migration example

The example bucket policy below conforms to the `V2 (2023-04-17)`. The users and application mentioned in the `Principal` element are allowed to perform the specified actions in the specified buckets.

```json
{
    "Version": "2023-04-17",
    "Id": "MyBucketPolicy",
    "Statement": [
        {
            "Sid": "DelegateAccess",
            "Effect": "Allow",
            "Principal": {
                "SCW": "user_id:example-g0l4-4h6d-0fd3299d5d70",
                "SCW": "application_id:0fd3299-example-g0l4-4h6d-d5d70"
            },
            "Action": [
                "s3:ListBucket",
                "s3:GetObject"
            ],
            "Resource": [
                "example-bucket",
                "example-bucket/*"
            ]
        }
    ]
}
```

The example below policy below has the same effect as the V2, but conforms to the `V3 (2023-06-07-alpha)`. Everybody who is **NOT** the users or applications specified in the `NotPrincipal` element is denied access.
 
```json
{
    "Version": "2023-06-07-alpha",
    "Id": "MyBucketPolicy",
    "Statement": [
        {
            "Sid": "DelegateAccess",
            "Effect": "Deny",
            "NotPrincipal": {
                "SCW": "user_id:example-g0l4-4h6d-0fd3299d5d70",
                "SCW": "application_id:0fd3299-example-g0l4-4h6d-d5d70"
            },
            "Action": [
                "s3:ListBucket",
                "s3:GetObject"
            ],
            "Resource": [
                "example-bucket",
                "example-bucket/*"
            ]
        }
    ]
}
```
