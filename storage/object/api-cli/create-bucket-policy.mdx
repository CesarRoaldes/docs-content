---
meta:
  title: Creating and applying a bucket policy
  description: This page shows how to create and apply a bucket policy to a specific bucket using the Scaleway CLI
content:
  h1: Creating and applying a bucket policy
  paragraph: This page shows how to create and apply a bucket policy to a specific bucket using the Scaleway CLI
tags: bucket policy bucket bucket-policy object storage object-storage s3
dates:
  validation: 2023-09-29
  posted: 2023-09-29
categories:
  - storage
  - object-storage
---

<Macro id="storage-bucket-policy" />

<Macro id="iam-requirements" />

<Message type="requirement">
  - You have an account and are logged into the [Scaleway console](https://console.scaleway.com)
  - You have [created an Object Storage bucket](/storage/object/how-to/create-a-bucket/)
  - You have [installed the AWS CLI](/storage/object/api-cli/object-storage-aws-cli/)
  - You have created an IAM policy 
</Message>

## How to create a bucket policy

1. Create the `bucket-policy.json` file.

2. Open it in a code editor and paste the following code inside:
    ```json
    {
        "Version": "2023-06-07-alpha",
        "Id": "MyBucketPolicy",
        "Statement": [
            {
                "Sid": "Deny access to all except user",
                "Effect": "Deny",
                "NotPrincipal": {
                    "SCW": "user_id:<USER_ID>"
                },
                "Action": "*",
                "Resource": [
                    "<BUCKET_NAME>",
                    "<BUCKET_NAME>/*"
                ]
            }
        ]
    }
    ```
3. Replace the `<USER_ID>` placeholder with the ID of the user you want to grant access to. You can also grant access to an [application](/storage/object/api-cli/bucket-policy/#principal).
    <Message type="important">
    The `NotPrincipal` element denies access to all users and applications **except** the one specified in this element.
    </Message>
4. Add all the authorized operations to the `Action` element. Refer to the [list of supported actions](/storage/object/api-cli/bucket-policy/#action) for more information.

5. Replace the `<BUCKET_NAME>` placeholders in the `Resource` element with the name of the concerned bucket. Refer to the [resource documentation](/storage/object/api-cli/bucket-policy/#resource) for more information.

<Message type="note">
Refer to the [Bucket policies description](/storage/object/api-cli/bucket-policy/#bucket-policy-description) for more details on each string.
</Message>

## How to apply a bucket policy

1. Open a terminal and access the folder containing the `bucket-policy.json` file. 

2. Run the command below to apply the policy. Replace `<BUCKET_NAME>` with the name of your bucket.
    ```sh
    aws s3api put-bucket-policy --bucket <BUCKET_NAME> --policy file://bucket-policy.json
    ```
    <Message type="note">
      Each bucket can have only one bucket policy.
    </Message>
3. Run the command below to display the bucket policy applied to your bucket.
    ```sh
    aws s3api get-bucket-policy --bucket <BUCKET_NAME>
    ```
    An output similar to the following displays:
    ```sh
    {
    "Policy": "{\"Version\": \"2023-06-07-alpha\", \"Id\": \"MyBucketPolicy\", \"Statement\": [{\"Action\": [\"s3:ListBucket\", \"s3:GetObject\"], \"NotPrincipal\": {\"SCW\": \"user_id:example-g0l4-4h6d-b9c2-0fd3299d5d70\"}, \"Resource\": [\"my-bucket\", \"my-bucket/*\"], \"Effect\": \"Deny\", \"Sid\": \"DelegateAccess\"}]}"
    }
    ```

## Bucket policy examples

### Bucket policy using the Principal element

The following example uses the `Principal` element to deny a specific user or application access to resources. 

With this policy, the user or application cannot perform any action in the specified bucket.

    ```json
    {
        "Version": "2023-06-07-alpha",
        "Id": "MyBucketPolicy",
        "Statement": [
            {
                "Sid": "DenyAccess",
                "Effect": "Deny",
                "Principal": {
                    "SCW": "user_id:example-g0l4-4h6d-0fd3299d5d70"
                },
                "Action": [
                    "s3:*",
                ],
                "Resource": [
                    "example-bucket",
                    "example-bucket/*"
                ]
            }
        ]
    }
    ```

### Bucket policy using the NotPrincipal element

The following example uses the `NotPrincipal` element to prevent anyone **EXCEPT** the user or application from accessing specific resources.

With this policy, the user or application is allowed perform any action in the specified bucket.

    ```json
    {
        "Version": "2023-06-07-alpha",
        "Id": "MyBucketPolicy",
        "Statement": [
            {
                "Sid": "DenyAccess",
                "Effect": "Deny",
                "NotPrincipal": {
                    "SCW": "user_id:example-g0l4-4h6d-0fd3299d5d70"
                },
                "Action": [
                    "s3:*",
                ],
                "Resource": [
                    "example-bucket",
                    "example-bucket/*"
                ]
            }
        ]
    }
    ```

### Bucket policy using the Principal and the NotPrincipal elements

The following example uses both the `Principal` and the `NotPrincipal` elements:

- Everyone **EXCEPT** the user or application is denied access. 

- The user or application is allowed to access
 the specified resources, but cannot put or delete objects.

    ```json
    {
        "Version": "2023-06-07-alpha",
        "Id": "MyBucketPolicy",
        "Statement": [
            {
                "Sid": "DenyAccess",
                "Effect": "Deny",
                "NotPrincipal": {
                    "SCW": "user_id:example-g0l4-4h6d-0fd3299d5d70"
                },
                "Action": [
                    "s3:*",
                ],
                "Resource": [
                    "example-bucket",
                    "example-bucket/*"
                ]
            },
            {
                "Sid": "DenySpecificActions",
                "Effect": "Deny",
                "Principal": {
                    "SCW": "user_id:example-g0l4-4h6d-0fd3299d5d70"
                },
                "Action": [
                    "s3:DeleteObject",
                    "s3:DeleteObjects",
                    "s3:PutObject"
                ],
                "Resource": [
                    "example-bucket",
                    "example-bucket/*"
                ]
            }
        ]
    }
    ```

### Bucket policy using Principal, NotPrincipal, Action and NotAction elements

- The first statement uses the `NotPrincipal` and  `Action` elements to deny every action to everyone **EXCEPT** the stated user. 

- The second statement uses the `Principal` and `NotAction` elements to deny every action **EXCEPT** the ones listed to the user.
 
    ```json
    {
        "Version": "2023-06-07-alpha",
        "Id": "MyBucketPolicy",
        "Statement": [
            {
                "Sid": "Deny access to all except user",
                "Effect": "Deny",
                "NotPrincipal": {
                    "SCW": "user_id:example-g0l4-4h6d-0fd3299d5d70"
                },
                "Action": [
                    "s3:*",
                ],
                "Resource": [
                    "example-bucket",
                    "example-bucket/*"
                ]
            },
            {
                "Sid": "Deny all actions except List and Get to user",
                "Effect": "Deny",
                "Principal": {
                    "SCW": "user_id:example-g0l4-4h6d-0fd3299d5d70"
                },
                "NotAction": [
                    "s3:ListBucket",
                    "s3:GetObject"
                ],
                "Resource": [
                    "example-bucket",
                    "example-bucket/*"
                ]
            }
        ]
    }
    ```



<Navigation title="See Also">
  <PreviousButton to="/storage/object/api-cli/bucket-policy">Understanding bucket policies</PreviousButton>
  <NextButton to="/storage/object/api-cli/combining-iam-and-object-storage">Configuring access with IAM and bucket policies</NextButton>
</Navigation>
