---
meta:
  title: How to move existing Kapsule clusters to Routed IPs
  description: Safely moving Kapsule clusters to Routed IPs
content:
  h1: How to move existing Kapsule clusters to Routed IPs
  paragraph: Safely moving Kapsule clusters to Routed IPs
tags: load-balancer load-balancer-ip kubernetes ip flexible-ip
dates:
  validation: 2023-04-22
  posted: 2023-04-22
categories:
  - kubernetes
---

As part of our ongoing efforts to enhance infrastructure capabilities and provide better services to our customers, Scaleway is [introducing Routed IPs for all products](https://www.scaleway.com/en/news/routed-ips-are-coming-to-all-scaleway-products/), including Kubernetes (K8s) worker nodes.

Routed IPs boost performance by eliminating the overhead of Network Address Translation, ensuring direct connectivity to Instances without any latency or processing delays. They enable [IP mobility](https://www.scaleway.com/en/docs/compute/instances/concepts/#ip-mobility), simplifying the management and movement of IPs across different products within the Scaleway ecosystem.

Additionally, Routed IPs offer first-level support for IPv6, allowing IPv6 addresses to stay directly connected to Instances. However, IPv6 support for Kapsule is currently unavailable due to compatibility constraints with current Container Network Interfaces (CNIs).

Moreover, Routed IPs allow multiple IPv4 addresses to be attached to a single Instance, facilitating specific use cases like IP failover. While this feature may have limited relevance in a Kubernetes context, it offers added flexibility for other products.

<Message type="important">
    NAT IPs will reach end-of-life in Q4/2024. After this date, Scaleway will organize migrations for all clusters to transition to Routed IPs. 
    Migrations will be planned region by region, with specific dates to be announced.
</Message>

## Moving your Kapsule cluster to Routed IPs

Newly created Kapsule clusters are deployed with IP mobility enabled by default. For existing clusters you can launch the migration to Routed IPs manually.

<Macro id="requirements" />

- A Scaleway account logged into the [console](https://console.scaleway.com)
- [Owner](/identity-and-access-management/iam/concepts/#owner) status or [IAM permissions](/identity-and-access-management/iam/concepts/#permission) allowing you to perform actions in the intended Organization
- Created a [Kubernetes cluster](/containers/kubernetes/how-to/create-cluster/) that uses NAT IPs
- A valid [API key](/identity-and-access-management/iam/how-to/create-api-keys/)


<Message type="important">
    Activating Routed IPs on K8s nodes will require draining each node before reconfiguration and reboot. **Single-node clusters will experience downtime during this process**.
    It is recommended to have **at least two nodes** and proper configuration to minimize downtime.
</Message>

1. Configure the following variables for your Kapsule cluster:
    ```
    REGION=fr-par # The region of your cluster. Can be either "fr-par", "nl-ams", or "pl-waw"
    CLUSTER_ID=b69106db-e212-4fff-9584-5da4a47217ed # The ID of your Kapsule cluster
    SCW_SECRET_KEY=196dadd9-5685-42c8-aa71-a34d46861303 # Your Scaleway secret key
    ```
2. Run the following command to launch the migration of exisiting Kapsule clusters to Routed IPs:
    ```
    curl --location "https://api.scaleway.com/k8s/v1/regions/$REGION/clusters/$CLUSTER_ID/migrate-to-routed-ips" --header "x-auth-token: $SCW_SECRET_KEY" --header 'Content-Type: application/json' --data '{}'
    ```
    <Message type="note">
        For Kubernetes clusters using dynamic IPs the migration to Routed IPs will trigger a node reboot and change the nodes public IP address.
        If you are using a dynamic IP for filtering or whitelisting, make sure to update your configuration to the nodes new IP.
    </Message>

